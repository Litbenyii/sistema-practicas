generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* ===================== ENUMS ===================== */

enum Role {
  STUDENT
  COORDINATION
  SUPERVISOR
  EVALUATOR
}

enum Status {
  PEND_EVAL
  APPROVED
  REJECTED
}

enum PracticeStatus {
  ABIERTA
  CERRADA
}

enum DocumentType {
  INFORME
  BITACORA
}

enum PracticaVeranoEstado {
  PENDIENTE
  APROBADO
  RECHAZADO
  EN_PROCESO
}

/* ===================== MODELS ===================== */

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  rut          String   @unique
  name         String
  password     String
  role         Role
  finalGrade   Float?
  enabled      Boolean  @default(true)
  createdAt    DateTime @default(now())

  Student      Student?

  PracticesAsSupervisor Practice[] @relation("SupervisorPractices")
  PracticesAsEvaluator  Practice[] @relation("EvaluatorPractices")
  Evaluations           Evaluation[]
}

model Student {
  id        Int    @id @default(autoincrement())
  userId    Int    @unique
  career    String

  User      User   @relation(fields: [userId], references: [id])

  Applications     Application[]
  PracticeRequests PracticeRequest[]
  Practices        Practice[]
}

model Offer {
  id        Int      @id @default(autoincrement())
  title     String
  company   String
  location  String
  details   String

  hours     Int?
  modality  String?
  startDate DateTime?

  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  deadline  DateTime?

  Applications Application[]
}

model Application {
  id        Int      @id @default(autoincrement())
  studentId Int
  offerId   Int
  status    Status   @default(PEND_EVAL)
  createdAt DateTime @default(now())

  Student   Student  @relation(fields: [studentId], references: [id])
  Offer     Offer    @relation(fields: [offerId], references: [id])
}

model PracticeRequest {
  id         Int      @id @default(autoincrement())
  studentId  Int
  company    String
  tutorName  String
  tutorEmail String
  startDate  DateTime
  endDate    DateTime
  details    String?
  status     Status   @default(PEND_EVAL)
  createdAt  DateTime @default(now())

  Student    Student  @relation(fields: [studentId], references: [id])
}

model Practice {
  id           Int            @id @default(autoincrement())
  studentId    Int
  supervisorId Int?
  evaluatorId  Int?

  status       PracticeStatus @default(ABIERTA)
  hours        Int?
  finalGrade   Float?

  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  Student      Student        @relation(fields: [studentId], references: [id])
  Supervisor   User?          @relation("SupervisorPractices", fields: [supervisorId], references: [id])
  Evaluator    User?          @relation("EvaluatorPractices", fields: [evaluatorId], references: [id])

  Documents    Document[]
  Evaluations  Evaluation[]
}

model Document {
  id         Int          @id @default(autoincrement())
  practiceId Int
  type       DocumentType
  url        String
  uploadedAt DateTime     @default(now())

  Practice   Practice     @relation(fields: [practiceId], references: [id])
}

model Evaluation {
  id          Int      @id @default(autoincrement())
  practiceId  Int
  evaluatorId Int
  role        Role
  score       Float?
  comments    String?
  createdAt   DateTime @default(now())

  Practice    Practice @relation(fields: [practiceId], references: [id])
  Evaluator   User     @relation(fields: [evaluatorId], references: [id])
}

model PracticaVerano {
  id               Int                  @id @default(autoincrement())
  rut              String
  nombreEstudiante String
  carrera          String
  empresa          String
  areaPractica     String
  email            String?
  telefono         String?
  estado           PracticaVeranoEstado @default(PENDIENTE)
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
}
